<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#FAFAF8">
<title>Copy Paste, Make Trillions â€” Data Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #FAFAF8;
    --surface: #FFFFFF;
    --surface-2: #F4F3F0;
    --border: #E4E2DC;
    --border-light: #EDEBE6;
    --text: #1A1A1A;
    --text-mid: #4A4A4A;
    --text-muted: #8A8780;
    --blue: #3D6BE0;
    --coral: #E8634A;
    --green: #2BA06A;
    --purple: #7B5FC7;
    --amber: #D4940A;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    font-weight: 400;
    line-height: 1.65;
    -webkit-font-smoothing: antialiased;
    padding-bottom: 40px;
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
  }

  /* â”€â”€ Page title â”€â”€ */
  .page-title {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 28px;
    font-weight: 400;
    color: var(--text);
    margin-bottom: 4px;
  }

  .page-sub {
    font-size: 14px;
    color: var(--text-muted);
    font-weight: 300;
  }

  .mobile-br { display: none; }

  /* â”€â”€ Embed wrapper: this is what goes inside a blog â”€â”€ */
  .embed-chart {
    max-width: 960px;
    width: 100%;
    margin: 20px auto;
    padding: 0 16px;
  }

  .chart-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--blue);
    margin-bottom: 6px;
    font-weight: 500;
  }

  .chart-title {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 20px;
    font-weight: 400;
    margin-bottom: 4px;
    color: var(--text);
  }

  .chart-desc {
    font-size: 13.5px;
    color: var(--text-muted);
    margin-bottom: 6px;
    font-weight: 300;
  }

  .chart-note {
    font-size: 11px;
    color: var(--text-muted);
    font-style: italic;
    margin-bottom: 16px;
    opacity: 0.7;
  }

  /* â”€â”€ Controls â”€â”€ */
  .controls-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .toggle-wrap {
    display: flex;
    gap: 2px;
    background: var(--surface-2);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 2px;
  }

  .toggle-btn {
    padding: 5px 14px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-family: 'Barlow', sans-serif;
    font-size: 12px;
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .toggle-btn:hover { color: var(--text-mid); }

  .toggle-btn.active {
    background: var(--surface);
    color: var(--text);
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  }

  .legend {
    display: flex;
    gap: 16px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11.5px;
    color: var(--text-muted);
  }

  .legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 2px;
  }

  .legend-dot.count-dot { background: var(--blue); }
  .legend-dot.value-dot { background: var(--coral); }

  /* â”€â”€ Corridor rows â”€â”€ */
  .corridor-list { display: flex; flex-direction: column; }

  .c-row {
    display: grid;
    grid-template-columns: 210px 1fr 50px;
    align-items: center;
    gap: 12px;
    padding: 7px 10px;
    border-radius: 8px;
    cursor: default;
    transition: background 0.2s ease;
    opacity: 0;
    transform: translateX(-12px);
    animation: slideIn 0.5s ease forwards;
  }

  .c-row.no-entrance {
    opacity: 1;
    transform: none;
    animation: none;
  }

  .c-row:hover { background: var(--surface); }

  .c-row + .c-row { border-top: 1px solid var(--border-light); }

  .c-label {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .c-flags {
    font-size: 15px;
    line-height: 1;
    display: flex;
    align-items: center;
    gap: 2px;
    flex-shrink: 0;
  }

  .c-flags .arrow-icon {
    font-size: 10px;
    color: var(--text-muted);
    margin: 0 1px;
    font-style: normal;
  }

  .c-names {
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  .c-names .primary {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    line-height: 1.3;
    white-space: nowrap;
  }

  .c-names .secondary {
    font-size: 10.5px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 0.5px;
  }

  .c-bars {
    display: flex;
    flex-direction: column;
    gap: 3px;
    min-width: 0;
  }

  .c-bar-track {
    height: 14px;
    background: var(--surface-2);
    border-radius: 5px;
    overflow: hidden;
  }

  .c-bar-fill {
    height: 100%;
    border-radius: 5px;
    transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
    width: 0;
  }

  .c-bar-fill.count-bar { background: var(--blue); opacity: 0.7; }
  .c-bar-fill.value-bar { background: var(--coral); opacity: 0.8; }

  .c-val {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 500;
    text-align: right;
    color: var(--text);
  }

  /* Highlight top row */
  .c-row.top-row {
    background: linear-gradient(135deg, rgba(61,107,224,0.03), rgba(232,99,74,0.03));
    border: 1px solid var(--border-light);
    margin-bottom: 4px;
  }

  .c-row.top-row .primary { color: var(--blue); }

  /* â”€â”€ Tooltip â”€â”€ */
  .tip {
    position: fixed;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 12.5px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s ease;
    z-index: 100;
    box-shadow: 0 6px 24px rgba(0,0,0,0.07);
    max-width: 240px;
  }

  .tip.show { opacity: 1; }

  .tip-title {
    font-weight: 600;
    font-size: 13px;
    margin-bottom: 6px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border-light);
  }

  .tip-row {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    padding: 2px 0;
    color: var(--text-muted);
  }

  .tip-row span:last-child {
    font-family: 'JetBrains Mono', monospace;
    color: var(--text);
    font-weight: 500;
  }

  /* â”€â”€ Archetype rows â”€â”€ */
  .arch-list { display: flex; flex-direction: column; gap: 2px; }

  .a-row {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    cursor: default;
    opacity: 0;
    transform: translateY(8px);
    animation: slideUp 0.5s ease forwards;
  }

  .a-row:hover { background: rgba(0,0,0,0.015); }

  .a-bg {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    border-radius: 8px;
    transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
    width: 0;
    opacity: 0.07;
  }

  .a-content {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr auto auto auto;
    align-items: center;
    gap: 14px;
    padding: 9px 14px;
  }

  .a-rank {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
    margin-right: 4px;
  }

  .a-name {
    font-size: 13.5px;
    font-weight: 500;
    line-height: 1.35;
  }

  .a-name .a-cat {
    display: block;
    font-size: 11px;
    font-weight: 300;
    color: var(--text-muted);
    margin-top: 1px;
  }

  .a-pill {
    background: var(--surface-2);
    border: 1px solid var(--border-light);
    border-radius: 16px;
    padding: 3px 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
  }

  .a-stat {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 500;
    text-align: right;
    min-width: 65px;
    color: var(--text);
  }

  .a-stat .a-stat-label {
    font-family: 'Barlow', sans-serif;
    font-size: 9.5px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    display: block;
    font-weight: 400;
  }

  .a-pct {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text-muted);
    text-align: right;
    min-width: 44px;
  }

  .clr-ecom { color: var(--coral); }
  .clr-ai { color: var(--purple); }
  .clr-fin { color: var(--green); }
  .clr-clean { color: var(--amber); }
  .clr-ride { color: var(--blue); }
  .bg-ecom { background: var(--coral); }
  .bg-ai { background: var(--purple); }
  .bg-fin { background: var(--green); }
  .bg-clean { background: var(--amber); }
  .bg-ride { background: var(--blue); }

  /* â”€â”€ Callout cards â”€â”€ */
  .callouts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 16px;
  }

  .callout {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 18px;
  }

  .callout-num {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 26px;
    line-height: 1;
    margin-bottom: 6px;
  }

  .callout-text {
    font-size: 11.5px;
    color: var(--text-muted);
    line-height: 1.5;
    font-weight: 300;
  }

  /* â”€â”€ Separator â”€â”€ */
  .sep {
    height: 24px;
  }

  /* â”€â”€ Flip / Role Reversal rows â”€â”€ */
  .flip-list { display: flex; flex-direction: column; gap: 2px; }

  .f-header-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9.5px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-muted);
    font-weight: 500;
  }

  .f-row {
    position: relative;
    display: grid;
    grid-template-columns: 90px 24px 150px 1fr auto;
    align-items: center;
    gap: 8px;
    padding: 7px 14px;
    border-radius: 8px;
    cursor: default;
    opacity: 0;
    transform: translateY(8px);
    animation: slideUp 0.5s ease forwards;
    transition: background 0.2s ease;
  }

  .f-row:hover { background: var(--surface); }
  .f-row + .f-row { border-top: 1px solid var(--border-light); }

  .f-source, .f-variant { min-width: 0; text-align: left; white-space: nowrap; }

  .f-company {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    white-space: nowrap;
  }

  .f-val {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10.5px;
    color: var(--text-muted);
  }

  .f-variant .f-company { color: var(--green); }

  .f-arrow-block {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--text-muted);
    font-size: 14px;
  }

  .f-delta-bar-track {
    height: 6px;
    background: var(--surface-2);
    border-radius: 3px;
    overflow: hidden;
  }

  .f-delta-bar-fill {
    height: 100%;
    background: var(--green);
    border-radius: 3px;
    opacity: 0.3;
    transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
    width: 0;
  }

  .f-delta {
    text-align: right;
    min-width: 80px;
  }

  .f-delta-val {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 500;
    color: var(--green);
  }

  .f-delta-mult {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
  }

  /* â”€â”€ Animations â”€â”€ */
  @keyframes slideIn {
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes slideUp {
    to { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ Responsive â”€â”€ */

  /* Tablet */
  @media (max-width: 768px) {
    .embed-chart { max-width: 100%; }
    .c-row { grid-template-columns: 190px 1fr 50px; }
    .a-content { grid-template-columns: 1fr auto auto auto; gap: 12px; }
    .page-title { font-size: 24px; }
    .page-sub { font-size: 13px; }
  }

  /* Mobile */
  @media (max-width: 600px) {
    .embed-chart { padding: 0 14px; margin: 14px auto; }
    .page-title { font-size: 22px; }
    .page-sub { font-size: 12.5px; }
    .mobile-br { display: inline; }
    .chart-title { font-size: 17px; }
    .chart-label { font-size: 9px; letter-spacing: 2.5px; }
    .chart-desc { font-size: 12px; }
    .chart-note { font-size: 10px; }
    .sep { height: 16px; }

    /* Corridors: stack label above bar */
    .c-row {
      grid-template-columns: 1fr auto;
      grid-template-rows: auto auto;
      gap: 4px 10px;
      padding: 8px 10px;
    }
    .c-label { grid-column: 1; grid-row: 1; }
    .c-bars { grid-column: 1 / -1; grid-row: 2; }
    .c-val { grid-column: 2; grid-row: 1; align-self: center; font-size: 12px; }
    .c-flags { font-size: 14px; }
    .c-names .primary { font-size: 12.5px; }
    .c-bar-track { height: 10px; }

    /* Archetypes: drop pill, tighten */
    .a-content { grid-template-columns: 1fr auto auto; gap: 8px; padding: 8px 12px; }
    .a-pill { display: none; }
    .a-name { font-size: 12.5px; }
    .a-name .a-cat { font-size: 10px; }
    .a-stat { font-size: 12px; min-width: 50px; }
    .a-stat .a-stat-label { font-size: 8.5px; }
    .a-pct { font-size: 11px; min-width: 36px; }
    .a-rank { font-size: 9px; }

    /* Flips */
    .f-row { grid-template-columns: 100px 20px 120px 1fr auto; gap: 6px; padding: 7px 10px; }
    .f-header { display: grid !important; grid-template-columns: 100px 20px 120px 1fr auto !important; gap: 6px !important; }
    .f-company { font-size: 12px; }
    .f-val { font-size: 9.5px; }
    .f-arrow-block { font-size: 12px; }
    .f-delta-val { font-size: 12px; }
    .f-delta-mult { font-size: 9px; }
    .f-delta { min-width: 60px; }

    .controls-row { flex-direction: column; align-items: flex-start; gap: 8px; }
    .toggle-btn { font-size: 11.5px; padding: 5px 12px; }

    /* Tooltip: bottom sheet on mobile */
    .tip {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      top: auto;
      max-width: 100%;
      border-radius: 14px 14px 0 0;
      padding: 16px 20px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
      box-shadow: 0 -4px 24px rgba(0,0,0,0.1);
      transform: translateY(100%);
      transition: transform 0.25s ease, opacity 0.25s ease;
    }
    .tip.show {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Very small phones */
  @media (max-width: 380px) {
    .embed-chart { padding: 0 10px; }
    .page-title { font-size: 19px; }
    .chart-title { font-size: 16px; }
    .c-names .primary { font-size: 11.5px; }
    .f-row { grid-template-columns: 80px 16px 100px 1fr auto; gap: 4px; }
    .f-header { grid-template-columns: 80px 16px 100px 1fr auto !important; gap: 4px !important; }
    .f-company { font-size: 11px; }
    .f-delta-val { font-size: 11px; }
    .f-delta { min-width: 50px; }
  }
</style>
</head>
<body>

<div id="tip" class="tip"></div>

<div class="embed-chart" style="text-align:center; padding-top:32px; padding-bottom:8px;">
  <h1 class="page-title">Copy Paste, Make Trillions</h1>
  <p class="page-sub">An interactive look at how borrowed ideas become<br class="mobile-br"> billion-dollar companies.</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CHART 1 â€” CORRIDORS
     Drop this <div class="embed-chart"> block into your blog
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="embed-chart" id="chart-corridors">
  <div class="chart-label">01 â€” Corridors</div>
  <div class="chart-title">Where Ideas Travel</div>
  <div class="chart-desc">The top cross-border corridors for derivative companies, by share of total count and total value created.</div>

  <div class="controls-row">
    <div class="toggle-wrap">
      <button class="toggle-btn active" data-sort="value" onclick="sortCorridors('value')">By % of Value</button>
      <button class="toggle-btn" data-sort="count" onclick="sortCorridors('count')">By % of Count</button>
    </div>
  </div>

  <div class="corridor-list" id="corridor-list"></div>

</div>

<div class="sep"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CHART 2 â€” ARCHETYPES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="embed-chart" id="chart-archetypes">
  <div class="chart-label">02 â€” Archetypes</div>
  <div class="chart-title">What Gets Copied</div>
  <div class="chart-desc">The most replicated business models, ranked by total value created. Variant count shows how many derivative companies share each archetype.</div>
  <div class="chart-note">Note: A company may appear in more than one archetype.</div>

  <div class="arch-list" id="arch-list"></div>

</div>

<div class="sep"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CHART 3 â€” WHEN THE STUDENT BEATS THE TEACHER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="embed-chart" id="chart-flips">
  <div class="chart-label">03 â€” Role Reversals</div>
  <div class="chart-title">When the Student Beats the Teacher</div>
  <div class="chart-desc">Cases where the derivative company surpassed the original in valuation â€” sorted by the size of the gap.</div>

  <div class="flip-list" id="flip-list">
    <div class="f-header" style="display:grid; grid-template-columns:90px 24px 150px 1fr auto; gap:8px; padding:0 14px 6px; border-bottom:1px solid var(--border); margin-bottom:4px;">
      <span class="f-header-label">Source</span>
      <span></span>
      <span class="f-header-label">Variant</span>
      <span></span>
      <span class="f-header-label" style="text-align:right; min-width:80px;">Delta</span>
    </div>
  </div>
</div>

<script>
// â”€â”€ DATA â”€â”€
const corridors = [
  { from: "China", to: "US", code: "CHN â†” USA", f1: "ðŸ‡¨ðŸ‡³", f2: "ðŸ‡ºðŸ‡¸", count: 23.4, value: 43.2 },
  { from: "India", to: "US", code: "IND â†” USA", f1: "ðŸ‡®ðŸ‡³", f2: "ðŸ‡ºðŸ‡¸", count: 4.6, value: 6.1 },
  { from: "Singapore", to: "US", code: "SGP â†” USA", f1: "ðŸ‡¸ðŸ‡¬", f2: "ðŸ‡ºðŸ‡¸", count: 8.0, value: 5.9 },
  { from: "UK", to: "US", code: "GBR â†” USA", f1: "ðŸ‡¬ðŸ‡§", f2: "ðŸ‡ºðŸ‡¸", count: 5.3, value: 5.2 },
  { from: "Argentina", to: "US", code: "ARG â†” USA", f1: "ðŸ‡¦ðŸ‡·", f2: "ðŸ‡ºðŸ‡¸", count: 0.5, value: 4.5 },
  { from: "Canada", to: "China", code: "CAN â†” CHN", f1: "ðŸ‡¨ðŸ‡¦", f2: "ðŸ‡¨ðŸ‡³", count: 0.7, value: 4.1 },
  { from: "China", to: "Singapore", code: "CHN â†” SGP", f1: "ðŸ‡¨ðŸ‡³", f2: "ðŸ‡¸ðŸ‡¬", count: 1.6, value: 4.0 },
  { from: "Germany", to: "US", code: "DEU â†” USA", f1: "ðŸ‡©ðŸ‡ª", f2: "ðŸ‡ºðŸ‡¸", count: 4.0, value: 3.6 },
  { from: "S. Korea", to: "US", code: "KOR â†” USA", f1: "ðŸ‡°ðŸ‡·", f2: "ðŸ‡ºðŸ‡¸", count: 4.0, value: 2.9 },
  { from: "China", to: "India", code: "CHN â†” IND", f1: "ðŸ‡¨ðŸ‡³", f2: "ðŸ‡®ðŸ‡³", count: 2.6, value: 2.8 }
];

const archetypes = [
  { name: "Fullstack Marketplace + Logistics", cat: "E-Commerce", n: 14, val: 629378, pct: 22.2, c: "ecom" },
  { name: "C2C Marketplace", cat: "E-Commerce", n: 18, val: 484663, pct: 17.1, c: "ecom" },
  { name: "AI Accelerator Chip", cat: "AI / ML Platform", n: 9, val: 131340, pct: 4.6, c: "ai" },
  { name: "QR / Mobile Wallet", cat: "Fintech â€” Payments", n: 19, val: 122575, pct: 4.3, c: "fin" },
  { name: "Payments Superapp + Lending", cat: "Fintech â€” Lending", n: 21, val: 118695, pct: 4.2, c: "fin" },
  { name: "Online Payment Platform", cat: "Fintech â€” Payments", n: 2, val: 100800, pct: 3.6, c: "fin" },
  { name: "Premium DTC EV", cat: "Cleantech", n: 20, val: 98631, pct: 3.5, c: "clean" },
  { name: "Daily Deals", cat: "E-Commerce", n: 2, val: 84400, pct: 3.0, c: "ecom" },
  { name: "Ride-Hailing Marketplace", cat: "Ride-Hailing", n: 13, val: 80421, pct: 2.8, c: "ride" },
  { name: "Foundation Model API", cat: "AI / ML Platform", n: 9, val: 79392, pct: 2.8, c: "ai" }
];

// â”€â”€ TOOLTIP â”€â”€
const tip = document.getElementById('tip');
const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

function showTip(e, html) {
  tip.innerHTML = html;
  tip.classList.add('show');
}
function hideTip() { tip.classList.remove('show'); }
function fmtPct(v) { return Number(v).toFixed(1) + '%'; }

// Desktop: follow cursor
document.addEventListener('mousemove', e => {
  if (!isMobile && tip.classList.contains('show')) {
    tip.style.left = Math.min(e.clientX + 14, window.innerWidth - 260) + 'px';
    tip.style.top = (e.clientY - 8) + 'px';
  }
});

// Mobile: tap outside to dismiss
document.addEventListener('click', e => {
  if (isMobile && tip.classList.contains('show') && !e.target.closest('.c-row, .a-row, .f-row')) {
    hideTip();
  }
});

// â”€â”€ CORRIDORS â”€â”€
let curSort = 'value';
let corridorInitialized = false;

function sortCorridors(by) {
  curSort = by;
  document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-sort="${by}"]`).classList.add('active');
  renderCorridors();
}

function renderCorridors() {
  const el = document.getElementById('corridor-list');
  const sorted = [...corridors].sort((a, b) => b[curSort] - a[curSort]);
  const barColor = curSort === 'value' ? 'value-bar' : 'count-bar';
  const maxVal = Math.max(...sorted.map(c => c[curSort]));

  // FLIP: record old positions
  const oldPositions = {};
  if (corridorInitialized) {
    el.querySelectorAll('.c-row').forEach(row => {
      oldPositions[row.dataset.code] = row.getBoundingClientRect();
    });
  }

  el.innerHTML = sorted.map((c, i) => {
    const isTop = i === 0;
    const nameDisplay = `${c.from} â†” ${c.to}`;

    return `
    <div class="c-row ${isTop ? 'top-row' : ''} ${corridorInitialized ? 'no-entrance' : ''}"
         data-code="${c.code}"
         style="${corridorInitialized ? '' : 'animation-delay: ' + i * 35 + 'ms'}"
         onmouseenter="showTip(event, \`
           <div class='tip-title'>${c.f1} â†” ${c.f2} ${nameDisplay}</div>
           <div class='tip-row'><span>% of Companies</span><span>${fmtPct(c.count)}</span></div>
           <div class='tip-row'><span>% of Value</span><span>${fmtPct(c.value)}</span></div>
           <div class='tip-row'><span>Value / Count</span><span>${(c.value / c.count).toFixed(1)}Ã—</span></div>
         \`)"
         onmouseleave="hideTip()">
      <div class="c-label">
        <div class="c-flags">
          ${c.f1}<i class="arrow-icon">â†”</i>${c.f2}
        </div>
        <div class="c-names">
          <span class="primary">${nameDisplay}</span>
        </div>
      </div>
      <div class="c-bars">
        <div class="c-bar-track">
          <div class="c-bar-fill ${barColor}" data-w="${(c[curSort] / maxVal) * 100}"></div>
        </div>
      </div>
      <div class="c-val">${fmtPct(c[curSort])}</div>
    </div>`;
  }).join('');

  requestAnimationFrame(() => {
    el.querySelectorAll('.c-bar-fill').forEach(b => { b.style.width = b.dataset.w + '%'; });

    // FLIP: animate from old positions to new
    if (corridorInitialized && Object.keys(oldPositions).length) {
      el.querySelectorAll('.c-row').forEach(row => {
        const code = row.dataset.code;
        const oldRect = oldPositions[code];
        if (!oldRect) return;
        const newRect = row.getBoundingClientRect();
        const deltaY = oldRect.top - newRect.top;
        if (Math.abs(deltaY) < 1) return;
        row.style.transform = `translateY(${deltaY}px)`;
        row.style.transition = 'none';
        requestAnimationFrame(() => {
          row.style.transition = 'transform 0.45s cubic-bezier(0.25, 1, 0.5, 1)';
          row.style.transform = 'translateY(0)';
        });
      });
    }
    corridorInitialized = true;
  });
}

// â”€â”€ ARCHETYPES â”€â”€
function renderArchetypes() {
  const el = document.getElementById('arch-list');
  const max = archetypes[0].val;

  el.innerHTML = archetypes.map((a, i) => `
    <div class="a-row" style="animation-delay: ${i * 45}ms"
         onmouseenter="showTip(event, \`
           <div class='tip-title'>${a.name}</div>
           <div class='tip-row'><span>Category</span><span>${a.cat}</span></div>
           <div class='tip-row'><span>Variants</span><span>${a.n} companies</span></div>
           <div class='tip-row'><span>Total Value</span><span>$${(a.val / 1000).toFixed(0)}B</span></div>
           <div class='tip-row'><span>% of Total</span><span>${fmtPct(a.pct)}</span></div>
         \`)"
         onmouseleave="hideTip()">
      <div class="a-bg bg-${a.c}" data-w="${(a.val / max) * 100}"></div>
      <div class="a-content">
        <div class="a-name">
          <span class="a-rank">#${i + 1}</span>
          <span class="clr-${a.c}">${a.name}</span>
          <span class="a-cat">${a.cat}</span>
        </div>
        <div class="a-pill">${a.n} variants</div>
        <div class="a-stat">
          <span class="a-stat-label">Value</span>
          $${(a.val / 1000).toFixed(0)}B
        </div>
        <div class="a-pct">${fmtPct(a.pct)}</div>
      </div>
    </div>
  `).join('');

  requestAnimationFrame(() => {
    el.querySelectorAll('.a-bg').forEach(b => { b.style.width = b.dataset.w + '%'; });
  });
}

// â”€â”€ INIT â”€â”€
renderCorridors();
renderArchetypes();
renderFlips();

function renderFlips() {
  const flips = [
    { source: "eBay", sVal: 37240, variant: "Alibaba", vVal: 354830, delta: 317590 },
    { source: "Groupon", sVal: 555, variant: "Meituan", vVal: 84400, delta: 83845 },
    { source: "eBay", sVal: 37240, variant: "MercadoLibre", vVal: 100800, delta: 63560 },
    { source: "Zopa", sVal: 1030, variant: "SoFi", vVal: 26160, delta: 25130 },
    { source: "Instagram", sVal: 1010, variant: "Xiaohongshu", vVal: 17000, delta: 15990 },
    { source: "Klarna", sVal: 6830, variant: "Affirm", vVal: 16600, delta: 9770 },
    { source: "Ada", sVal: 1200, variant: "Sierra AI", vVal: 10000, delta: 8800 },
    { source: "Shield AI", sVal: 5300, variant: "Helsing AI", vVal: 13779, delta: 8479 },
    { source: "Gilt", sVal: 250, variant: "Vipshop", vVal: 8570, delta: 8320 }
  ];

  const el = document.getElementById('flip-list');
  const header = el.querySelector('.f-header').outerHTML;

  function fmt(v) {
    return v >= 1000 ? '$' + (v / 1000).toFixed(1).replace(/\.0$/, '') + 'B' : '$' + v + 'M';
  }

  const maxDelta = Math.max(...flips.map(f => f.delta));

  el.innerHTML = header + flips.map((f, i) => {
    const mult = (f.vVal / f.sVal).toFixed(0);
    return `
    <div class="f-row" style="animation-delay: ${i * 45}ms"
         onmouseenter="showTip(event, \`
           <div class='tip-title'>${f.source} â†’ ${f.variant}</div>
           <div class='tip-row'><span>Source Valuation</span><span>${fmt(f.sVal)}</span></div>
           <div class='tip-row'><span>Variant Valuation</span><span>${fmt(f.vVal)}</span></div>
           <div class='tip-row'><span>Delta</span><span>+${fmt(f.delta)}</span></div>
           <div class='tip-row'><span>Multiple</span><span>${mult}Ã—</span></div>
         \`)"
         onmouseleave="hideTip()">
      <div class="f-source">
        <span class="f-company">${f.source}</span>
        <span class="f-val">${fmt(f.sVal)}</span>
      </div>
      <div class="f-arrow-block">â†’</div>
      <div class="f-variant">
        <span class="f-company">${f.variant}</span>
        <span class="f-val">${fmt(f.vVal)}</span>
      </div>
      <div class="f-delta-bar-track">
        <div class="f-delta-bar-fill" data-w="${(f.delta / maxDelta) * 100}"></div>
      </div>
      <div class="f-delta">
        <div class="f-delta-val">+${fmt(f.delta)}</div>
        <div class="f-delta-mult">${mult}Ã—</div>
      </div>
    </div>`;
  }).join('');

  requestAnimationFrame(() => {
    el.querySelectorAll('.f-delta-bar-fill').forEach(b => { b.style.width = b.dataset.w + '%'; });
  });
}
</script>

<div class="embed-chart" style="text-align:center; padding-top:16px; padding-bottom:8px; opacity:0.5; font-size:12px; color:var(--text-muted);">
  DCM Ventures
</div>

</body>
</html>
